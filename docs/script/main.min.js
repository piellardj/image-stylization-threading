!function(){"use strict";var e={747:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getQueryStringValue=t.downloadTextFile=t.declarePolyfills=void 0,t.downloadTextFile=function(e,t){var n="text/plain",r=new Blob([e],{type:n});if(void 0!==window.navigator&&void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(r,t);else{var a=URL.createObjectURL(r),o=document.createElement("a");o.download=t,o.href=a,o.dataset.downloadurl="".concat(n,":").concat(o.download,":").concat(o.href),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout((function(){URL.revokeObjectURL(a)}),5e3)}},t.getQueryStringValue=function(e){var t=window.location.href,n=t.indexOf("?");if(n>=0){var r=t.substring(n+1);if(r.length>0)for(var a=0,o=r.split("&");a<o.length;a++){var i=o[a].split("=");if(2===i.length&&decodeURIComponent(i[0])===e)return decodeURIComponent(i[1])}}return null},t.declarePolyfills=function(){"function"!=typeof Array.prototype.includes&&(console.log("Declaring Array.includes polyfill..."),Object.defineProperty(Array.prototype,"includes",{value:function(e){return this.indexOf(e)>=0}})),"function"!=typeof String.prototype.repeat&&(console.log("Declaring String.repeat polyfill..."),Object.defineProperty(String.prototype,"repeat",{value:function(e){if(e<0||e===1/0)throw new RangeError;for(var t="",n=0;n<e;n++)t+=this;return t}}))}},633:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(747)),s=n(61),h=n(886),c=n(174),d=n(204),l=n(607);n(457),function(){var e=window;try{if(e.self!==e.top||e.location!==e.parent.location)return!0}catch(e){return!0}return!1}()||(i.declarePolyfills(),function(){var e=new h.PlotterCanvas2D,t=null,n=null,r=!0;function a(){r&&(n.reset(s.Parameters.linesOpacity,s.Parameters.linesThickness),t.reset(),r=!1),n.computeNextSegments(20)&&s.Parameters.showIndicators&&n.updateIndicators(Page.Canvas.setIndicatorText),t.plot(),s.Parameters.debug&&n.drawDebugView(e.context),requestAnimationFrame(a)}function o(t){e.blur=t}function u(a){Page.Canvas.showLoader(!1),n=new d.ThreadComputer(a),t=new l.ThreadPlotter(e,n),r=!0}s.Parameters.addRedrawObserver((function(){null==t||t.reset()})),s.Parameters.addResetObserver((function(){r=!0})),s.Parameters.addBlurChangeObserver(o),o(s.Parameters.blur),s.Parameters.addFileUploadObserver(u),Page.Canvas.showLoader(!0);var p=new Image;p.addEventListener("load",(function(){u(p),requestAnimationFrame(a)})),p.src="./resources/cat.jpg",s.Parameters.addDownloadObserver((function(){var e=new c.PlotterSVG;new l.ThreadPlotter(e,n).plot();var t=e.export();i.downloadTextFile(t,"image-as-threading.svg")})),s.Parameters.addDownloadInstructionsObserver((function(){var e=n.instructions;i.downloadTextFile(e,"image-as-threading_instructions.txt")}))}())},457:function(){},61:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.EShape=t.EMode=t.Parameters=void 0;var i=o(n(747));n(457);var s,h,c="shape-tabs-id",d="pegs-range-id",l="quality-tabs-id",u="thread-mode-tabs-id",p="opacity-range-id",g="thickness-range-id",f="display-pegs-checkbox-id",v="invert-colors-checkbox-id",m="show-indicators-checkbox-id",b="blur-range-id",y="instructions-download-id";!function(e){e.RECTANGLE="0",e.ELLIPSIS="1"}(s||(t.EShape=s={})),function(e){e.MONOCHROME="0",e.COLORS="1"}(h||(t.EMode=h={}));var C=[];function P(){for(var e=0,t=C;e<t.length;e++)(0,t[e])()}var w=[];function O(){for(var e=0,t=w;e<t.length;e++)(0,t[e])()}Page.Tabs.addObserver(c,O),Page.Range.addLazyObserver(d,O),Page.Tabs.addObserver(l,O),Page.Tabs.addObserver(u,O),Page.Range.addLazyObserver(p,O),Page.Range.addLazyObserver(g,O),Page.Checkbox.addObserver(f,P),Page.Checkbox.addObserver(v,O),Page.Canvas.Observers.canvasResize.push(P);var x="1"===i.getQueryStringValue("debug");function T(){var e=Page.Checkbox.isChecked(m);Page.Canvas.setIndicatorsVisibility(e)}Page.Canvas.setIndicatorVisibility("error-average",x),Page.Canvas.setIndicatorVisibility("error-mean-square",x),Page.Canvas.setIndicatorVisibility("error-variance",x),Page.Checkbox.addObserver(m,T),T();var S=function(){function e(){}return e.addFileUploadObserver=function(e){Page.FileControl.addUploadObserver("input-image-upload-button",(function(t){if(1===t.length){Page.Canvas.showLoader(!0);var n=new FileReader;n.onload=function(){var t=new Image;t.addEventListener("load",(function(){e(t)})),t.src=n.result},n.readAsDataURL(t[0])}}))},Object.defineProperty(e,"debug",{get:function(){return x},enumerable:!1,configurable:!0}),Object.defineProperty(e,"shape",{get:function(){return Page.Tabs.getValues(c)[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"pegsCount",{get:function(){return Page.Range.getValue(d)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"quality",{get:function(){return+Page.Tabs.getValues(l)[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"mode",{get:function(){return Page.Tabs.getValues(u)[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"nbLines",{get:function(){return Page.Range.getValue("lines-range-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"linesOpacity",{get:function(){var e=Page.Range.getValue(p);return Math.pow(2,e-7)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"linesThickness",{get:function(){return Page.Range.getValue(g)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"displayPegs",{get:function(){return Page.Checkbox.isChecked(f)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"invertColors",{get:function(){return Page.Checkbox.isChecked(v)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"showIndicators",{get:function(){return Page.Checkbox.isChecked(m)},enumerable:!1,configurable:!0}),e.addRedrawObserver=function(e){C.push(e)},e.addResetObserver=function(e){w.push(e)},Object.defineProperty(e,"blur",{get:function(){return Page.Range.getValue(b)},enumerable:!1,configurable:!0}),e.addBlurChangeObserver=function(e){Page.Range.addObserver(b,e)},e.addDownloadObserver=function(e){Page.FileControl.addDownloadObserver("result-download-id",e)},e.addDownloadInstructionsObserver=function(e){Page.FileControl.addDownloadObserver(y,e)},e}();function E(){var e=S.mode===h.MONOCHROME,t=!S.invertColors;Page.Controls.setVisibility(y,e&&t)}t.Parameters=S,Page.Tabs.addObserver(u,E),Page.Checkbox.addObserver(v,E),E()},781:function(e,t,n){var r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.useAdvancedCompositing=t.resetCanvasCompositing=t.computeRawColor=t.applyCanvasCompositing=t.ECompositingOperation=t.EColor=void 0,n(457),function(e){e[e.DARKEN=0]="DARKEN",e[e.LIGHTEN=1]="LIGHTEN"}(r||(t.ECompositingOperation=r={})),function(e){e[e.MONOCHROME=0]="MONOCHROME",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=3]="BLUE"}(a||(t.EColor=a={}));var o=!0;function i(e){return e===a.MONOCHROME?{r:1,g:1,b:1}:{r:e===a.RED?1:0,g:e===a.GREEN?1:0,b:e===a.BLUE?1:0}}function s(e){e.globalCompositeOperation="source-over"}t.useAdvancedCompositing=function(){return o},t.computeRawColor=i,t.applyCanvasCompositing=function(e,t,n,a){var h=i(t);if(o){var c=a===r.LIGHTEN?"lighter":"difference";if(e.globalCompositeOperation=c,e.globalCompositeOperation===c){var d=Math.ceil(255*n);return void(e.strokeStyle="rgb(".concat(h.r*d,", ").concat(h.g*d,", ").concat(h.b*d,")"))}o=!1,Page.Demopage.setErrorMessage("advanced-compositing-not-supported","Your browser does not support canvas2D compositing '".concat(c,"'. The project will not run as expected."))}s(e),a===r.DARKEN&&(h.r=1-h.r,h.g=1-h.g,h.b=1-h.b),e.strokeStyle="rgba(".concat(255*h.r,", ").concat(255*h.g,", ").concat(255*h.b,", ").concat(n,")")},t.resetCanvasCompositing=s},792:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PlotterBase=void 0;var n=function(){function e(){}return e.prototype.drawBrokenLine=function(e,t,n,r,a){for(var o=[],i=0;i<e.length-1;i++)o.push({from:e[i],to:e[i+1]});this.drawLines(o,t,n,r,a)},e}();t.PlotterBase=n},886:function(e,t,n){var r,a=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.PlotterCanvas2D=void 0;var o=n(781),i=n(792);n(457);var s=function(e){function t(){var t,n=this;return(n=e.call(this)||this).canvas=Page.Canvas.getCanvas(),n.context=n.canvas.getContext("2d",{alpha:!1}),n.cssPixel=null!==(t=window.devicePixelRatio)&&void 0!==t?t:1,n}return a(t,e),t.prototype.resize=function(){var e=Math.floor(this.cssPixel*this.canvas.clientWidth),t=Math.floor(this.cssPixel*this.canvas.clientHeight);this.canvas.width===e&&this.canvas.height===t||(this.canvas.width=e,this.canvas.height=t)},t.prototype.initialize=function(e){this.context.fillStyle=e.backgroundColor,this.context.lineJoin="round",(0,o.resetCanvasCompositing)(this.context),this.context.fillRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.finalize=function(){},Object.defineProperty(t.prototype,"blur",{set:function(e){0===e?this.canvas.style.filter="":(this.canvas.style.filter="blur(".concat(e,"px)"),this.canvas.style.filter="url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='a' x='0' y='0' width='1' height='1'%3E%3CfeGaussianBlur stdDeviation='".concat(e,"' result='b'/%3E%3CfeMorphology operator='dilate' radius='").concat(e,"'/%3E %3CfeMerge%3E%3CfeMergeNode/%3E%3CfeMergeNode in='b'/%3E%3C/feMerge%3E%3C/filter%3E%3C/svg%3E#a\")"))},enumerable:!1,configurable:!0}),t.prototype.drawLines=function(e,t,n,r,a){if(e.length>=1){(0,o.applyCanvasCompositing)(this.context,t,n,r),this.context.lineWidth=a*this.cssPixel;for(var i=0,s=e;i<s.length;i++){var h=s[i];this.context.beginPath(),this.context.moveTo(h.from.x*this.cssPixel,h.from.y*this.cssPixel),this.context.lineTo(h.to.x*this.cssPixel,h.to.y*this.cssPixel),this.context.stroke(),this.context.closePath()}(0,o.resetCanvasCompositing)(this.context)}},t.prototype.drawPoints=function(e,t,n){if(e.length>0){this.context.fillStyle=t,this.context.strokeStyle="none";for(var r=0,a=e;r<a.length;r++){var o=a[r];this.context.beginPath(),this.context.arc(o.x*this.cssPixel,o.y*this.cssPixel,.5*n*this.cssPixel,0,2*Math.PI),this.context.fill(),this.context.closePath()}}},Object.defineProperty(t.prototype,"size",{get:function(){return{width:Math.floor(this.canvas.width/this.cssPixel),height:Math.floor(this.canvas.height/this.cssPixel)}},enumerable:!1,configurable:!0}),t}(i.PlotterBase);t.PlotterCanvas2D=s},174:function(e,t,n){var r,a=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.PlotterSVG=void 0;var o=n(781),i=n(792),s=n(567),h="gaussianBlur",c=function(e){function t(){return e.call(this)||this}return a(t,e),t.prototype.resize=function(){},t.prototype.initialize=function(e){this.writer=new s.XMLWriter,this.hasBlur=e.blur>0,this.writer.addLine('<?xml version="1.0" encoding="UTF-8" standalone="no"?>'),this.writer.startBlock('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 '.concat(1e3," ").concat(1e3,'">')),this.hasBlur&&(this.writer.startBlock("<defs>"),this.writer.startBlock('<filter id="'.concat(h,'" x="0" y="0">')),this.writer.addLine('<feGaussianBlur in="SourceGraphic" stdDeviation="'.concat(e.blur,'"/>')),this.writer.endBlock("</filter>"),this.writer.endBlock("</defs>"),this.writer.startBlock('<g filter="url(#'.concat(h,')">'))),this.writer.addLine('<rect fill="white" stroke="none" x="'.concat(-10,'" y="').concat(-10,'" width="').concat(1020,'" height="').concat(1020,'"/>'))},t.prototype.finalize=function(){this.hasBlur&&this.writer.endBlock("</g>"),this.writer.endBlock("</svg>")},t.prototype.drawLines=function(e,t,n,r,a){if(e.length>=1){var i=void 0;if((0,o.useAdvancedCompositing)()){this.writer.startBlock("<defs>"),this.writer.startBlock('<style type="text/css">'),this.writer.startBlock("<![CDATA["),this.writer.addLine("line { mix-blend-mode: difference; }"),r===o.ECompositingOperation.LIGHTEN&&this.writer.addLine("svg { filter: invert(1); background: black; }"),this.writer.endBlock("]]>"),this.writer.endBlock("</style>"),this.writer.endBlock("</defs>");var s=Math.ceil(255*n),h=(0,o.computeRawColor)(t);i="rgb(".concat(h.r*s,", ").concat(h.g*s,", ").concat(h.b*s,")")}else s=(0,o.useAdvancedCompositing)()?255:0,h=(0,o.computeRawColor)(t),i="rgba(".concat(h.r*s,", ").concat(h.g*s,", ").concat(h.b*s,", ").concat(n,")");this.writer.startBlock('<g stroke="'.concat(i,'" stroke-width="').concat(a,'" stroke-linecap="round" fill="none">'));for(var c=0,d=e;c<d.length;c++){var l=d[c];this.writer.addLine('<line x1="'.concat(l.from.x.toFixed(1),'" y1="').concat(l.from.y.toFixed(1),'" x2="').concat(l.to.x.toFixed(1),'" y2="').concat(l.to.y.toFixed(1),'"/>'))}this.writer.endBlock("</g>")}},t.prototype.drawPoints=function(e,t,n){if(e.length>0){this.writer.startBlock('<g fill="'.concat(t,'" stroke="none">'));for(var r=0,a=e;r<a.length;r++){var o=a[r];this.writer.addLine('<circle cx="'.concat(o.x.toFixed(1),'" cy="').concat(o.y.toFixed(1),'" r="').concat(.5*n,'"/>'))}this.writer.endBlock("</g>")}},t.prototype.export=function(){var e=Date.now(),t=this.writer.result;return console.log("Concatenation took ".concat(Date.now()-e," ms.")),t},Object.defineProperty(t.prototype,"size",{get:function(){return{width:1e3,height:1e3}},enumerable:!1,configurable:!0}),t}(i.PlotterBase);t.PlotterSVG=c},567:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.XMLWriter=void 0;var n=function(){function e(){this.indentationLevel=0,this.lines=[]}return Object.defineProperty(e.prototype,"result",{get:function(){return this.lines.join("\n")},enumerable:!1,configurable:!0}),e.prototype.startBlock=function(e){this.addLine(e),this.indentationLevel++},e.prototype.endBlock=function(e){this.indentationLevel--,this.addLine(e)},e.prototype.addLine=function(e){this.lines.push(this.prefix+e)},Object.defineProperty(e.prototype,"prefix",{get:function(){return"\t".repeat(this.indentationLevel)},enumerable:!1,configurable:!0}),e}();t.XMLWriter=n},204:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ThreadComputer=void 0;var r=n(61),a=n(506),o=n(781),i=n(68),s=n(64),h=-9007199254740991,c=2*Math.PI;function d(e,t,n){return e<t?t:e>n?n:e}function l(e,t,n){return e*(1-n)+t*n}function u(e){return 0===e.length?null:e[Math.floor(Math.random()*e.length)]}var p=function(){function e(e){this.hiddenCanvasData=null,this.sourceImage=e,this.hiddenCanvas=document.createElement("canvas"),this.hiddenCanvasContext=this.hiddenCanvas.getContext("2d"),this.reset(.0625,1)}return e.prototype.drawThread=function(e,t){var n=this,a=this.computeTransformation(e.size),i=a.scaling*this.hiddenCanvasScale*this.lineThickness,s=r.Parameters.invertColors?o.ECompositingOperation.LIGHTEN:o.ECompositingOperation.DARKEN;this.thread.iterateOnThreads(t,(function(t,r){for(var o=[],h=0,c=t;h<c.length;h++){var d=c[h];o.push(a.transform(d))}e.drawBrokenLine(o,r,n.lineOpacity,s,i)}))},e.prototype.drawPegs=function(e){for(var t=this.computeTransformation(e.size),n=t.scaling*this.hiddenCanvasScale*.5,r=[],a=0,o=this.pegs;a<o.length;a++){var i=o[a];r.push(t.transform(i))}e.drawPoints(r,"red",n)},e.prototype.drawDebugView=function(e){e.drawImage(this.hiddenCanvas,0,0,this.hiddenCanvas.width,this.hiddenCanvas.height)},e.prototype.computeNextSegments=function(e){var t=this,n=performance.now(),a=r.Parameters.nbLines;if(this.nbSegments===a)return!1;if(this.nbSegments>a)return this.thread.lowerNbSegments(a),this.resetHiddenCanvas(),this.thread.iterateOnThreads(0,(function(e,n){(0,o.applyCanvasCompositing)(t.hiddenCanvasContext,n,t.lineOpacityInternal,o.ECompositingOperation.LIGHTEN);for(var r=0;r+1<e.length;r++)t.drawSegmentOnHiddenCanvas(e[r],e[r+1])})),this.computeError(),!0;for(var i=null;this.nbSegments<a&&performance.now()-n<e;){var s=this.thread.getThreadToGrow();i!==s.color&&((0,o.applyCanvasCompositing)(this.hiddenCanvasContext,s.color,this.lineOpacityInternal,o.ECompositingOperation.LIGHTEN),this.thread.enableSamplingFor(s.color),i=s.color),this.computeSegment(s.thread),this.nbSegments%100==0&&this.computeError()}return!0},e.prototype.reset=function(e,t){this.lineOpacity=e,this.lineThickness=t,this.hiddenCanvasScale=r.Parameters.quality,r.Parameters.mode===r.EMode.MONOCHROME?this.thread=new i.ThreadMonochrome:this.thread=new s.ThreadRedBlueGreen,this.resetHiddenCanvas(),this.pegs=this.computePegs()},e.prototype.updateIndicators=function(e){e("pegs-count",this.pegs.length.toString()),e("segments-count",this.nbSegments.toString()),e("error-average",this.error.average.toString()),e("error-mean-square",this.error.meanSquare.toString()),e("error-variance",this.error.variance.toString())},Object.defineProperty(e.prototype,"nbSegments",{get:function(){return this.thread.totalNbSegments},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"instructions",{get:function(){if(r.Parameters.mode!==r.EMode.MONOCHROME)return"Instructions are only available for monochrome mode.";if(r.Parameters.invertColors)return"Instructions are only available for black thread.";for(var e=-1,t=-1,n=0,a=this.pegs;n<a.length;n++){var o=a[n];e<o.x&&(e=o.x),t<o.y&&(t=o.y)}var i=[];i.push("Generated by https://piellardj.github.io/image-stylization-threading.\n"),i.push("Here are instructions to reproduce this in real life. For the best result, make sure you used the website at the highest quality mode and the highest thread opacity.\n"),i.push("Space units used below are abstract, just scale it to whatever size you want. Typically, you can choose 1 unit = 1 millimeter."),i.push("Computed for a total size of ".concat(e,"x").concat(t,"."));var s=this.lineThickness*this.hiddenCanvasScale;i.push("Computed for a black thread of width ".concat(s," and opacity ").concat(this.lineOpacity," (this is equivalent to an opaque thread of width ").concat(s*this.lineOpacity,").")),i.push("\nFirst here are the positions of the pegs:");for(var h=this.pegs,c=0;c<h.length;c++)h[c].name="PEG_".concat(c),i.push("  - ".concat(h[c].name,": x=").concat(h[c].x.toFixed(2)," ; y=").concat(h[c].y.toFixed(2)));return i.push("\nThen here are the steps of the thread:"),this.thread.iterateOnThreads(0,(function(e){var t=e;i.push("  - First start from ".concat(t[0].name));for(var n=1;n<t.length;n++)i.push("  - then go to ".concat(t[n].name," (this is segment ").concat(n," / ").concat(t.length-1,")"))})),i.join("\n")},enumerable:!1,configurable:!0}),e.prototype.initializeHiddenCanvasLineProperties=function(){var e=this.lineThickness*this.hiddenCanvasScale;e<=1?(this.lineOpacityInternal=.5*this.lineOpacity*e,this.hiddenCanvasContext.lineWidth=1):(this.lineOpacityInternal=.5*this.lineOpacity,this.hiddenCanvasContext.lineWidth=e)},e.prototype.computeSegment=function(e){var t,n;if(0===e.length){var r=this.computeBestStartingSegment();e.push(r.peg1),t=r.peg1,n=r.peg2}else{t=e[e.length-1];var a=Math.min(e.length,20),o=e.slice(-a);n=this.computeBestNextPeg(t,o)}e.push(n),this.drawSegmentOnHiddenCanvas(t,n)},e.prototype.resetHiddenCanvas=function(){var t=e.computeBestSize(this.sourceImage,100*this.hiddenCanvasScale);this.hiddenCanvas.width=t.width,this.hiddenCanvas.height=t.height,(0,o.resetCanvasCompositing)(this.hiddenCanvasContext),this.hiddenCanvasContext.drawImage(this.sourceImage,0,0,t.width,t.height);var n=this.hiddenCanvasContext.getImageData(0,0,t.width,t.height);this.thread.adjustCanvasData(n.data,r.Parameters.invertColors),this.hiddenCanvasContext.putImageData(n,0,0),this.computeError(),this.initializeHiddenCanvasLineProperties()},e.prototype.computeError=function(){this.uploadCanvasDataToCPU(),this.error={average:0,variance:0,meanSquare:0};for(var e=this.hiddenCanvasData.width*this.hiddenCanvasData.height,t=3*e,n=0;n<e;n++){var r=127-this.hiddenCanvasData.data[4*n+0],a=127-this.hiddenCanvasData.data[4*n+1],o=127-this.hiddenCanvasData.data[4*n+2];this.error.average+=r+a+o,this.error.meanSquare+=r*r+a*a+o*o}for(this.error.average=Math.round(this.error.average/t),this.error.meanSquare=Math.round(this.error.meanSquare/t),n=0;n<e;n++){var i=((r=127-this.hiddenCanvasData.data[4*n+0])+(a=127-this.hiddenCanvasData.data[4*n+1])+(o=127-this.hiddenCanvasData.data[4*n+2]))/3-this.error.average;this.error.variance+=i*i}this.error.variance=Math.round(this.error.variance/t)},e.prototype.computeTransformation=function(e){return new a.Transformation(e,this.hiddenCanvas)},e.prototype.drawSegmentOnHiddenCanvas=function(e,t){this.hiddenCanvasContext.beginPath(),this.hiddenCanvasContext.moveTo(e.x,e.y),this.hiddenCanvasContext.lineTo(t.x,t.y),this.hiddenCanvasContext.stroke(),this.hiddenCanvasContext.closePath(),this.hiddenCanvasData=null},e.prototype.computeBestStartingSegment=function(){for(var e=[],t=h,n=1+Math.floor(this.pegs.length/100),r=0;r<this.pegs.length;r+=n)for(var a=r+1;a<this.pegs.length;a+=n){var o=this.pegs[r],i=this.pegs[a];if(!this.arePegsTooClose(o,i)){var s=this.computeSegmentPotential(o,i);s>t?(t=s,e=[{peg1:o,peg2:i}]):s===t&&e.push({peg1:o,peg2:i})}}return u(e)},e.prototype.computeBestNextPeg=function(e,t){for(var n=[],r=h,a=0,o=this.pegs;a<o.length;a++){var i=o[a];if(!this.arePegsTooClose(e,i)&&!t.includes(i)){var s=this.computeSegmentPotential(e,i);s>r?(r=s,n=[i]):s===r&&n.push(i)}}return u(n)},e.prototype.uploadCanvasDataToCPU=function(){if(null===this.hiddenCanvasData){var e=this.hiddenCanvas.width,t=this.hiddenCanvas.height;this.hiddenCanvasData=this.hiddenCanvasContext.getImageData(0,0,e,t)}},e.prototype.computeSegmentPotential=function(e,t){this.uploadCanvasDataToCPU();for(var n,r,a,o,i=0,s=(r=t,a=(n=e).x-r.x,o=n.y-r.y,Math.sqrt(a*a+o*o)),h=Math.ceil(s),c=0;c<h;c++){var d=(c+1)/(h+1),u={x:l(e.x,t.x,d),y:l(e.y,t.y,d)};i+=127-(this.sampleCanvasData(u)+255*this.lineOpacityInternal)}return i/h},e.prototype.sampleCanvasData=function(e){var t=this.hiddenCanvasData.width,n=this.hiddenCanvasData.height,r=d(Math.floor(e.x),0,t-1),a=d(Math.ceil(e.x),0,t-1),o=d(Math.floor(e.y),0,n-1),i=d(Math.ceil(e.y),0,n-1),s=this.sampleCanvasPixel(r,o),h=this.sampleCanvasPixel(a,o),c=this.sampleCanvasPixel(r,i),u=this.sampleCanvasPixel(a,i),p=e.x%1,g=l(s,h,p),f=l(c,u,p);return l(g,f,e.y%1)},e.prototype.sampleCanvasPixel=function(e,t){var n=4*(e+t*this.hiddenCanvasData.width);return this.thread.sampleCanvas(this.hiddenCanvasData.data,n)},e.computeBestSize=function(e,t){var n=t/Math.max(e.width,e.height);return{width:Math.ceil(e.width*n),height:Math.ceil(e.height*n)}},e.prototype.computePegs=function(){var e,t=1e3;e=(h=this.hiddenCanvas.width/this.hiddenCanvas.height)>1?{width:t,height:Math.round(t/h)}:{width:Math.round(t*h),height:t};var n=r.Parameters.shape,a=r.Parameters.pegsCount,o=[];if(n===r.EShape.RECTANGLE){this.arePegsTooClose=function(e,t){return e.x===t.x||e.y===t.y};var i=e.width,s=e.height,h=s/i,d=Math.round(.5*a/(1+h)),l=Math.round(.5*(a-2*d));o.push({x:0,y:0});for(var u=1;u<d;u++)o.push({x:i*(u/d),y:0});o.push({x:i,y:0});for(var p=1;p<l;p++)o.push({x:i,y:s*(p/l)});for(o.push({x:i,y:s}),u=d-1;u>=1;u--)o.push({x:i*(u/d),y:s});for(o.push({x:0,y:s}),p=l-1;p>=1;p--)o.push({x:0,y:s*(p/l)})}else{this.arePegsTooClose=function(e,t){var n=Math.abs(e.angle-t.angle);return Math.min(n,c-n)<=c/16};for(var g=.5*e.width,f=.5*e.height,v=Math.PI*(3*(g+f)-Math.sqrt((3*g+f)*(g+3*f)))/a,m=0;o.length<a;){var b=Math.cos(m),y=Math.sin(m),C={x:g*(1+b),y:f*(1+y),angle:m};o.push(C),m+=v/Math.sqrt(g*g*y*y+f*f*b*b)}}for(var P=0,w=o;P<w.length;P++)(C=w[P]).x*=this.hiddenCanvas.width/e.width,C.y*=this.hiddenCanvas.height/e.height;return o},e}();t.ThreadComputer=p},607:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ThreadPlotter=void 0;var r=n(61),a=function(){function e(e,t){this.plotter=e,this.threadComputer=t,this.nbSegmentsDrawn=0}return e.prototype.reset=function(){this.nbSegmentsDrawn=0},e.prototype.plot=function(){if(this.nbSegmentsDrawn!==this.threadComputer.nbSegments){if(this.nbSegmentsDrawn>this.threadComputer.nbSegments&&(this.nbSegmentsDrawn=0),0===this.nbSegmentsDrawn){var e={backgroundColor:r.Parameters.invertColors?"black":"white",blur:r.Parameters.blur};this.plotter.resize(),this.plotter.initialize(e),r.Parameters.displayPegs&&this.threadComputer.drawPegs(this.plotter),this.threadComputer.drawThread(this.plotter,0),this.plotter.finalize()}else this.threadComputer.drawThread(this.plotter,this.nbSegmentsDrawn);this.nbSegmentsDrawn=this.threadComputer.nbSegments}},e}();t.ThreadPlotter=a},45:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ThreadBase=void 0;var n=function(){function e(){this.sampleCanvas=null}return e.lowerNbSegmentsForThread=function(e,t){e.length=t>0?Math.min(e.length,t+1):0},e.computeNbSegments=function(e){return e.length>1?e.length-1:0},e.iterateOnThread=function(t,n,r,a){r<e.computeNbSegments(t)&&a(t.slice(r),n)},e}();t.ThreadBase=n},68:function(e,t,n){var r,a=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ThreadMonochrome=void 0;var o=n(781),i=n(45),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.threadPegs=[],t}return a(t,e),Object.defineProperty(t.prototype,"totalNbSegments",{get:function(){return i.ThreadBase.computeNbSegments(this.threadPegs)},enumerable:!1,configurable:!0}),t.prototype.lowerNbSegments=function(e){i.ThreadBase.lowerNbSegmentsForThread(this.threadPegs,e)},t.prototype.iterateOnThreads=function(e,t){i.ThreadBase.iterateOnThread(this.threadPegs,o.EColor.MONOCHROME,e,t)},t.prototype.getThreadToGrow=function(){return{thread:this.threadPegs,color:o.EColor.MONOCHROME}},t.prototype.adjustCanvasData=function(e,t){var n;n=t?function(e){return(255-e)/2}:function(e){return e/2};for(var r=e.length/4,a=0;a<r;a++){var o=n((e[4*a+0]+e[4*a+1]+e[4*a+2])/3);e[4*a+0]=o,e[4*a+1]=o,e[4*a+2]=o}},t.prototype.enableSamplingFor=function(){null===this.sampleCanvas&&(this.sampleCanvas=function(e,t){return e[t+0]})},t}(i.ThreadBase);t.ThreadMonochrome=s},64:function(e,t,n){var r,a=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ThreadRedBlueGreen=void 0;var o=n(781),i=n(45),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.threadPegsRed=[],t.threadPegsGreen=[],t.threadPegsBlue=[],t}return a(t,e),Object.defineProperty(t.prototype,"totalNbSegments",{get:function(){return i.ThreadBase.computeNbSegments(this.threadPegsRed)+i.ThreadBase.computeNbSegments(this.threadPegsGreen)+i.ThreadBase.computeNbSegments(this.threadPegsBlue)},enumerable:!1,configurable:!0}),t.prototype.lowerNbSegments=function(e){var t=this.computeIdealSegmentsRepartition(e);i.ThreadBase.lowerNbSegmentsForThread(this.threadPegsRed,t.red),i.ThreadBase.lowerNbSegmentsForThread(this.threadPegsGreen,t.green),i.ThreadBase.lowerNbSegmentsForThread(this.threadPegsBlue,t.blue)},t.prototype.iterateOnThreads=function(e,t){var n=this.computeIdealSegmentsRepartition(e);i.ThreadBase.iterateOnThread(this.threadPegsRed,o.EColor.RED,n.red,t),i.ThreadBase.iterateOnThread(this.threadPegsGreen,o.EColor.GREEN,n.green,t),i.ThreadBase.iterateOnThread(this.threadPegsBlue,o.EColor.BLUE,n.blue,t)},t.prototype.getThreadToGrow=function(){var e=this.computeIdealSegmentsRepartition(this.totalNbSegments+1);return e.red>0&&this.threadPegsRed.length<e.red+1?{thread:this.threadPegsRed,color:o.EColor.RED}:e.green>0&&this.threadPegsGreen.length<e.green+1?{thread:this.threadPegsGreen,color:o.EColor.GREEN}:{thread:this.threadPegsBlue,color:o.EColor.BLUE}},t.prototype.adjustCanvasData=function(e,t){var n,r=0,a=0,o=0;n=t?function(e){return(255-e)/2}:function(e){return e/2};for(var i=e.length/4,s=0;s<i;s++)r+=e[4*s+0],a+=e[4*s+1],o+=e[4*s+2],e[4*s+0]=n(e[4*s+0]),e[4*s+1]=n(e[4*s+1]),e[4*s+2]=n(e[4*s+2]);t||(r=255*i-r,a=255*i-a,o=255*i-o);var h=r+a+o;this.frequencyRed=r/h,this.frequencyGreen=a/h,this.frequencyBlue=o/h},t.prototype.enableSamplingFor=function(e){var t;t=e===o.EColor.RED?0:e===o.EColor.GREEN?1:2,this.sampleCanvas=function(e,n){return e[n+t]}},t.prototype.computeIdealSegmentsRepartition=function(e){for(var t=e*this.frequencyRed,n=e*this.frequencyGreen,r=e*this.frequencyBlue,a={red:Math.floor(t),green:Math.floor(n),blue:Math.floor(r)};a.red+a.green+a.blue<e;){var o=t-a.red/Math.max(1,a.red+a.green+a.blue),i=n-a.green/Math.max(1,a.red+a.green+a.blue),s=r-a.blue/Math.max(1,a.red+a.green+a.blue);o>i&&o>s?a.red++:i>o&&i>s?a.green++:a.blue++}return a},t}(i.ThreadBase);t.ThreadRedBlueGreen=s},506:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Transformation=void 0;var n=function(){function e(e,t){var n=e.width/t.width,r=e.height/t.height;this.scaling=Math.min(n,r),this.origin={x:.5*(e.width-this.scaling*t.width),y:.5*(e.height-this.scaling*t.height)}}return e.prototype.transform=function(e){return{x:this.origin.x+e.x*this.scaling,y:this.origin.y+e.y*this.scaling}},e}();t.Transformation=n}},t={};!function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}(633)}();